---
title: "WofostR_Tutorial"
subtitle: "R implementation of Wofost crop simulation model"
author: "Luca BÃ¼tikofer"
date: "`r Sys.Date()`"

# Use this to generate vignette files:
output: rmarkdown::html_vignette

# Use this to generate README.md for github:
# output:
#   md_document:
#     variant: markdown_github

vignette: >
  %\VignetteIndexEntry{WofostR Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

See [De Wit et al. (2019)][1] for details.

Python version available at [ajdewit/pcse][2] as part of the Python Crop Simulation Environment (PCSE/WOFOST).

***
### Installation
Install with `devtools::install_github('lucabutikofer/WofostR')`

***
### Testing

After installation is complete you can test the program with `test()`.This command uses the files published by [De Wit et al.][1] downloading a copy from the [WofostR_testData repository][3] to test either a specific routine (e.g. `test(component = "leafdynamics")`) or all available components if none is specified. Currently only "astro", "leafdynamics" and "potentialproduction" are implemented. Many routines are not independent funtions like in [PCSE/WOFOST][2] but are hardcoded within function `Wofost()`, which is run in the "potentialproduction" and "waterlimitedproduction" tests. Passing the "potentialproduction" or "waterlimitedproduction" tests means also passing "assimilation", "astro", "leafdynamics", "partitioning", "phenology", "respiration", "rootdynamics" and "transpiration" (although transpiration is not actually used to copute potential production).
By default only three test sets are randomly chosen to perform tests on. This is done to speed up the process. To perform tests on all available sets call `test(complete = TRUE)`.

```{r, eval = FALSE}
test(component = 'phenology', complete = TRUE)
test()
```

***
### Input files

Three types of input files are requred to run the Wofost():

- Crop objects
- Weather objects
- Soil objects (not implemented yet, only used for waterlimited production)

These are S4 classes containing the variables required by function `Wofost()`. Crop objects can be generated by calling `dwn.crop()`. This function retrieves specific crop parameters from [ajwdewit/WOFOST_crop_parameters][4] by specifying the crop and variety names.

```{r}
cr <- WofostR::dwn.crop(cropName = "sugarbeet",
                        variety = "Sugarbeet_601")
cr
str(cr, list.len = 2)
```

Weather objects must contain minimum and maximum temperature, radiation and latitude at daily time-steps starting from the day the model is started. An example weather object is saved in the package.

```{r}
load('../data/randomWeather.rda')
randomWeather
str(randomWeather, list.len = 2)
```

Soil objects are not implemented yet and are used only in water-limited production.

All input files can be generated by feeding to their omonimous builder function a named list with the same parameter names, by building one from scratch or modifying an existing one.

***
### Running Wofost

Wofost crop simulation model is run by functions `WofostPP()` or `WofostFD()` for Potential Production and Free Draining water-limited production respectively.
(09.08.2019: This will soon be wrapped in new function `Wofost()`)

```{r, fig.show = 'hold'}
out <- WofostR::WofostPP(crop = cr, w = randomWeather)
str(out)
plot(randomWeather@DAY[1:length(out$lai)], out$lai,
     main = 'Leaf Area Index', xlab = 'Date', ylab = 'LAI',
     type='l',col=4)
plot(randomWeather@DAY[1:length(out$tagp)], out$tagp,
     main = 'Total Above-Ground Production', xlab = 'Date', ylab = 'TAGP',
     type='l',col=4)
```





[1]: https://doi.org/10.1016/j.agsy.2018.06.018
[2]: https://github.com/ajwdewit/pcse.git
[3]: https://github.com/lucabutikofer/WofostR_testData.git
[4]: https://github.com/ajwdewit/WOFOST_crop_parameters.git
