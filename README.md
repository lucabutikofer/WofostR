# WofostR
R implementation of Wofost crop simulation model.

***
See [De Wit et al. (2019)][1] for details.

Python version available at [ajdewit/pcse][2] as part of the Python Crop Simulation Environment (PCSE/WOFOST).

***
### Installation
Install with `devtools::install_github('lucabutikofer/WofostR')`

***
### Testing

After installation is complete you can test the program with:

```R
test()
```

This uses the files published by [De Wit et al.][1] by downloading a copy from [WofostR_testData repository][3] to test either a specific routine (e.g. `test(component = "leafdynamics")`) or all available components if none is specified. Currently only "astro", "leafdynamics" and "potentialproduction" are implemented. Many routines are not independent funtions like in [PCSE/WOFOST][2] but are hardcoded within function `Wofost()`, which is run in the "potentialproduction" test. Passing the "potentialproduction" test means also passing "assimilation", "astro", "leafdynamics", "partitioning", "phenology", "respiration", "rootdynamics" and "transpiration" (though transpiration is not actually used to copute potential production).

By default only three test sets are randomly chosen to perform tests on. This is done to speed up the process. To perform tests on all available sets call `test(complete = TRUE)`.

***
### Input files

Three types of input files are requred to run the Wofost():

- Crop objects
- Weather objects
- Soil objects (not implemented yet, only used for waterlimited production)

These are S4 classes containing the variables required by function `Wofost()`. Crop objects can be generated by calling `dwn.crop()`. This function retrieves specific crop parameters from [ajwdewit/WOFOST_crop_parameters][4] by specifying the crop and variety names.

```R
cr <- dwn.crop(cropName = "potato", variety = "Potato_701")
cr
str(cr)
```

Weather objects must contain minimum and maximum temperature, radiation and latitude at daily time-steps starting from the day the model is started. An example weather object is saved in the package.

```R
w <- readRDS('data/weatherObj.RDS')
w
str(w)
```

Soil objects are not implemented yet and are used only in water-limited production.

All input files can be generated by feeding to their omonimous builder function a named list with the same parameter names, by building one from scratch or modifying an existing one.

***
### Running Wofost

Wofost crop simulation model is run by the function `Wofost()`. Potential production is computed by default, while water-limited production is called by setting the argument `waterlimiter = TRUE`.

```R
out <- Wofost(crop = cr, w = w)
str(out)
plot(w@DAY[1:length(out$lai)], out$lai,
     main = 'Leaf Area Index', xlab = 'Date', ylab = 'LAI',
     type='l')
```





[1]: https://doi.org/10.1016/j.agsy.2018.06.018
[2]: https://github.com/ajwdewit/pcse.git
[3]: https://github.com/lucabutikofer/WofostR_testData.git
[4]: https://github.com/ajwdewit/WOFOST_crop_parameters.git
